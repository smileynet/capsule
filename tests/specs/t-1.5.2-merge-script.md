# TDD Spec: Create merge.sh script for selective merge and archival

**Task:** t-1.5.2
**Feature:** Sign-off and merge prompt pair
**Epic:** Epic 1 - Shell-based Pipeline Prototype

## Context

scripts/merge.sh: verifies sign-off passed, selectively stages only implementation and test files (not worklog or temp files), commits on the worktree branch, merges to main with --no-ff, archives the worklog to a designated location, removes the worktree, deletes the feature branch, and closes the bead via bd.

## Test Cases

| # | Input / Setup | Expected Output | Notes |
|---|--------------|-----------------|-------|
| 1 | Run merge.sh on worktree with PASS sign-off | Merge commit on main, worktree removed | Happy path |
| 2 | Verify selective staging | Only src/ and test files committed, worklog.md excluded from merge | Worklog is archived, not merged |
| 3 | Verify --no-ff merge | `git log --oneline` shows merge commit (not fast-forward) | Preserves branch topology |
| 4 | Verify worklog archived | worklog.md moved to archive directory with bead-id in name | Preserved for auditing |
| 5 | Verify cleanup | Worktree directory gone, feature branch deleted | No leftover artifacts |
| 6 | Run merge.sh without prior sign-off PASS | Non-zero exit, error about missing sign-off | Gate enforcement |

## Edge Cases

- [ ] Merge conflict on main (another change landed) -- script reports error, does not force
- [ ] Bead already closed -- bd close is idempotent or handled gracefully
- [ ] Worktree has unstaged changes beyond impl/test -- those are discarded, not merged
- [ ] Archive directory does not exist yet -- script creates it

## Deliverable

scripts/merge.sh
