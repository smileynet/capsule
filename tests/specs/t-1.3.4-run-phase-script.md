# TDD Spec: Create run-phase.sh script for headless claude invocation

**Task:** t-1.3.4
**Feature:** Test-writer and test-review prompt pair
**Epic:** Epic 1 - Shell-based Pipeline Prototype

## Context

scripts/run-phase.sh takes a phase-name and worktree-path, optionally with --feedback for retry context. It loads the appropriate prompt template, invokes `claude -p` in headless mode, captures stdout and stderr, parses the signal from output, and returns exit codes: 0 for PASS, 1 for NEEDS_WORK, 2 for ERROR.

## Test Cases

| # | Input / Setup | Expected Output | Notes |
|---|--------------|-----------------|-------|
| 1 | Run with mock claude returning PASS signal | Exit code 0, signal JSON accessible | Happy path |
| 2 | Run with mock claude returning NEEDS_WORK signal | Exit code 1, feedback extractable from signal | Retry case |
| 3 | Run with mock claude returning ERROR signal | Exit code 2, error details in signal | Abort case |
| 4 | Run with mock claude producing no JSON signal | Exit code 2, error message about missing signal | Graceful degradation |
| 5 | Run with --feedback flag | Feedback text appended to prompt before invocation | Retry with context |
| 6 | Run with invalid phase-name | Non-zero exit, error about unknown phase | Input validation |

## Edge Cases

- [ ] Claude process times out (hung or infinite loop) -- script has a timeout mechanism
- [ ] Claude output is very large but signal is at the end -- parse-signal.sh handles it
- [ ] Worktree path contains spaces or special characters
- [ ] Concurrent invocations on different worktrees do not interfere

## Deliverable

scripts/run-phase.sh
