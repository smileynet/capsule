# TDD Spec: Full pipeline E2E smoke test

**Task:** t-1.6.4
**Feature:** Full pipeline orchestration
**Epic:** Epic 1 - Shell-based Pipeline Prototype

## Context

tests/test-full-pipeline.sh: end-to-end smoke test of the entire pipeline. Sets up template project, runs run-pipeline.sh, then asserts: tests exist on main, implementation passes tests, worklog archived, no worktree remains, bead is closed, and performs cleanup.

## Test Cases

| # | Input / Setup | Expected Output | Notes |
|---|--------------|-----------------|-------|
| 1 | Run full pipeline on template project | Pipeline completes with exit 0 | Full E2E happy path |
| 2 | Verify test files on main branch | Test files present and `go test` passes | Tests merged correctly |
| 3 | Verify implementation on main branch | Implementation files present and build succeeds | Code merged correctly |
| 4 | Verify worklog archived | Archive directory has worklog with all phase entries | Complete audit trail |
| 5 | Verify no worktree remains | No capsule worktree directories exist | Clean state |
| 6 | Verify bead closed | `bd show <bead-id>` shows done/closed | Pipeline lifecycle complete |

## Edge Cases

- [ ] Pipeline fails partway through -- test verifies error reporting and partial state
- [ ] Template project has pre-existing tests -- new tests coexist without conflict
- [ ] Smoke test cleans up after itself even on assertion failure (trap handler)
- [ ] Test has a reasonable timeout to catch infinite retry loops

## Deliverable

tests/test-full-pipeline.sh
