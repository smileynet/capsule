# TDD Spec: Validate sign-off/merge pair end-to-end

**Task:** t-1.5.3
**Feature:** Sign-off and merge prompt pair
**Epic:** Epic 1 - Shell-based Pipeline Prototype

## Context

Integration test starting after execute phase: run sign-off, verify it passes, run merge, verify implementation and test files appear on main branch, worklog is archived, worktree is removed, and bead is closed.

## Test Cases

| # | Input / Setup | Expected Output | Notes |
|---|--------------|-----------------|-------|
| 1 | Start after execute with passing tests, run sign-off | Signal is PASS, worklog has sign-off entry | Sign-off validates completed work |
| 2 | After sign-off PASS, run merge.sh | Merge commit on main with impl + test files | Full merge flow |
| 3 | Verify files on main branch | Implementation and test files present, worklog absent | Selective merge worked |
| 4 | Verify worklog archived | Archive directory contains worklog with bead metadata | Audit trail preserved |
| 5 | Verify worktree and branch cleaned up | No worktree directory, no feature branch in git branch list | Clean state |
| 6 | Verify bead status | `bd show <bead-id>` shows closed/done status | Pipeline completion |

## Edge Cases

- [ ] Sign-off returns NEEDS_WORK -- pipeline retries execute phase (not tested here, tested in pipeline)
- [ ] Merge fails due to conflict -- error reported, worktree preserved for manual resolution
- [ ] Network/filesystem error during cleanup -- partial cleanup handled gracefully
- [ ] Test verifies main branch has no worklog.md committed

## Deliverable

tests/test-phase-pair-merge.sh
